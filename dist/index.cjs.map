{"version":3,"sources":["../src/constants.ts","../src/dom.ts","../src/state.ts","../src/observer.ts","../src/index.ts"],"names":["CONFIG","defaultPaddingConfig","getRelativeShift","config","edge","offset","injectAnimationBeacon","style","getContainerPadding","container","applyTransform","state","targetX","targetY","element","cachedConfig","shift","finalX","finalY","applySticky","applyStatic","measureViewportSize","parent","isVertical","getScrollPosition","isWindow","getScrollParent","node","overflowY","getPageOffset","el","top","left","measureNaturalRect","isManaged","prevPosition","prevTransform","width","height","elOffset","parentOffset","isCompletelyOutOfView","rect","parentRect","readConfigFromDOM","edges","foundEdge","foundOffset","map","val","value","updateElementState","lastScrollPos","naturalRect","viewportSize","isStartAnchor","currentScroll","scrollDelta","edgePadding","naturalStart","dimension","isScrollingAway","isScrollingToward","isNaturalSafe","translation","isNaturallyPassed","currentVisualPos","shouldStick","stickyThreshold","stateRegistry","cleanupRegistry","resizeTickMap","refreshState","scheduleRefresh","handleResizeObserver","entries","changedNodes","e","handleVisualViewport","resizeObserver","mountElement","attributeObserver","mutations","_a","mutation","scrollTick","onScroll","scrollTarget","parentInUse","s","handleMutations","checkRemovals","type","addedNodes","removedNodes","handleAnimationStart","event","initPoliteSticky","index_default"],"mappings":"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","file":"index.cjs","sourcesContent":["export const CONFIG = {\r\n  className: \"sticky-polite\",\r\n  attrName: \"data-polite-state\",\r\n  epsilon: 1,\r\n};\r\n","import { CONFIG } from \"./constants\";\r\nimport { Config, Edge, ElementState, paddingConfig } from \"./types\";\r\n\r\nexport const defaultPaddingConfig = { top: 0, bottom: 0, left: 0, right: 0 };\r\n\r\nconst getRelativeShift = (config: Config): { x: number; y: number } => {\r\n  if (!config.valid) return { x: 0, y: 0 };\r\n  const { edge, offset } = config;\r\n\r\n  switch (edge) {\r\n    case \"top\":\r\n      return { x: 0, y: offset };\r\n    case \"bottom\":\r\n      return { x: 0, y: -offset };\r\n    case \"left\":\r\n      return { x: offset, y: 0 };\r\n    case \"right\":\r\n      return { x: -offset, y: 0 };\r\n  }\r\n};\r\n\r\nexport const injectAnimationBeacon = () => {\r\n  if (document.getElementById(\"sticky-polite-beacon\")) return;\r\n\r\n  const style = document.createElement(\"style\");\r\n  style.id = \"sticky-polite-beacon\";\r\n  style.innerHTML = `\r\n    @keyframes sticky-polite-announce { \r\n      from { opacity: 0.999; } \r\n      to { opacity: 1; } \r\n    }\r\n    .${CONFIG.className} { \r\n      animation-duration: 1ms; \r\n      animation-name: sticky-polite-announce; \r\n    }\r\n  `;\r\n  document.head.appendChild(style);\r\n};\r\n\r\nexport const getContainerPadding = (container: HTMLElement | Window): paddingConfig => {\r\n  if (container instanceof Window) {\r\n    return defaultPaddingConfig;\r\n  }\r\n\r\n  const style = getComputedStyle(container);\r\n  return {\r\n    top: parseInt(style.paddingTop, 10) || 0,\r\n    bottom: parseInt(style.paddingBottom, 10) || 0,\r\n    left: parseInt(style.paddingLeft, 10) || 0,\r\n    right: parseInt(style.paddingRight, 10) || 0,\r\n  };\r\n};\r\n\r\nexport const applyTransform = (state: ElementState, targetX: number, targetY: number) => {\r\n  const { element, cachedConfig } = state;\r\n  const shift = getRelativeShift(cachedConfig);\r\n\r\n  const finalX = targetX - shift.x;\r\n  const finalY = targetY - shift.y;\r\n\r\n  element.style.position = \"relative\";\r\n  element.style.transform = `translate3d(${finalX}px, ${finalY}px, 0)`;\r\n  element.setAttribute(CONFIG.attrName, \"intersect\");\r\n\r\n  state.currentTranslation = targetX !== 0 ? targetX : targetY;\r\n};\r\n\r\nexport const applySticky = (element: HTMLElement) => {\r\n  element.style.position = \"sticky\";\r\n  element.style.transform = \"\";\r\n  element.setAttribute(CONFIG.attrName, \"sticky\");\r\n};\r\n\r\nexport const applyStatic = (state: ElementState) => {\r\n  const { element, cachedConfig } = state;\r\n  const shift = getRelativeShift(cachedConfig);\r\n\r\n  element.style.position = \"relative\";\r\n  element.style.transform = `translate3d(${-shift.x}px, ${-shift.y}px, 0)`;\r\n  element.setAttribute(CONFIG.attrName, \"static\");\r\n};\r\n\r\nexport const measureViewportSize = (parent: HTMLElement, edge: Edge): number => {\r\n  const isVertical = edge === \"top\" || edge === \"bottom\";\r\n  if (parent === document.documentElement) {\r\n    if (window.visualViewport) {\r\n      return isVertical ? window.visualViewport.height : window.visualViewport.width;\r\n    }\r\n    return isVertical ? window.innerHeight : window.innerWidth;\r\n  }\r\n  return isVertical ? parent.clientHeight : parent.clientWidth;\r\n};\r\n\r\nexport const getScrollPosition = (parent: HTMLElement, edge: Edge): number => {\r\n  const isWindow = parent === document.documentElement;\r\n  if (edge === \"left\" || edge === \"right\") return isWindow ? window.scrollX : parent.scrollLeft;\r\n  return isWindow ? window.scrollY : parent.scrollTop;\r\n};\r\n\r\nexport const getScrollParent = (node: HTMLElement): HTMLElement => {\r\n  if (!node || node === document.body) return document.documentElement;\r\n  const style = getComputedStyle(node);\r\n  const overflowY = style.overflowY;\r\n  const isScrollable = overflowY !== \"visible\" && overflowY !== \"hidden\";\r\n  if (isScrollable && node.scrollHeight >= node.clientHeight) return node;\r\n  return getScrollParent(node.parentElement as HTMLElement);\r\n};\r\n\r\nexport const getPageOffset = (element: HTMLElement): { top: number; left: number } => {\r\n  let el: HTMLElement | null = element;\r\n  let top = 0;\r\n  let left = 0;\r\n\r\n  while (el) {\r\n    top += el.offsetTop;\r\n    left += el.offsetLeft;\r\n    el = el.offsetParent as HTMLElement;\r\n  }\r\n  return { top, left };\r\n};\r\n\r\nexport const measureNaturalRect = (element: HTMLElement, parent: HTMLElement): DOMRect => {\r\n  // 1. Check if we need to clean-slate the element\r\n  // We only need to do this if the element is currently heavily modified\r\n  // (Sticky or Transformed) to ensure we get true \"Natural\" dimensions.\r\n  const isManaged = element.hasAttribute(CONFIG.attrName);\r\n  const prevPosition = element.style.position;\r\n  const prevTransform = element.style.transform;\r\n\r\n  if (isManaged) {\r\n    element.style.position = \"relative\";\r\n    element.style.transform = \"\";\r\n  }\r\n\r\n  const { width, height } = element.getBoundingClientRect();\r\n  const elOffset = getPageOffset(element);\r\n\r\n  if (isManaged) {\r\n    element.style.position = prevPosition;\r\n    element.style.transform = prevTransform;\r\n  }\r\n\r\n  if (parent === document.documentElement) {\r\n    return {\r\n      top: elOffset.top,\r\n      left: elOffset.left,\r\n      width,\r\n      height,\r\n      bottom: elOffset.top + height,\r\n      right: elOffset.left + width,\r\n      x: elOffset.left,\r\n      y: elOffset.top,\r\n      toJSON: () => {},\r\n    };\r\n  }\r\n\r\n  const parentOffset = getPageOffset(parent);\r\n  const top = elOffset.top - parentOffset.top - (parent.clientTop || 0);\r\n  const left = elOffset.left - parentOffset.left - (parent.clientLeft || 0);\r\n\r\n  return {\r\n    top,\r\n    left,\r\n    width,\r\n    height,\r\n    bottom: top + height,\r\n    right: left + width,\r\n    x: left,\r\n    y: top,\r\n    toJSON: () => {},\r\n  };\r\n};\r\n\r\nexport const isCompletelyOutOfView = (element: HTMLElement, parent: HTMLElement): boolean => {\r\n  const rect = element.getBoundingClientRect();\r\n\r\n  let parentRect;\r\n  if (parent === document.documentElement) {\r\n    if (window.visualViewport) {\r\n      parentRect = {\r\n        top: 0,\r\n        left: 0,\r\n        bottom: window.visualViewport.height,\r\n        right: window.visualViewport.width,\r\n      };\r\n    } else {\r\n      parentRect = {\r\n        top: 0,\r\n        left: 0,\r\n        bottom: window.innerHeight,\r\n        right: window.innerWidth,\r\n      };\r\n    }\r\n  } else {\r\n    parentRect = parent.getBoundingClientRect();\r\n  }\r\n\r\n  return rect.bottom < parentRect.top || rect.top > parentRect.bottom || rect.right < parentRect.left || rect.left > parentRect.right;\r\n};\r\n\r\nexport const readConfigFromDOM = (element: HTMLElement): Config => {\r\n  // 1. Clean Slate: Temporarily remove inline positioning.\r\n  const prevPosition = element.style.position;\r\n  const isManaged = element.hasAttribute(CONFIG.attrName);\r\n\r\n  if (isManaged) {\r\n    element.style.position = \"\";\r\n  }\r\n\r\n  const edges: Edge[] = [\"top\", \"bottom\", \"left\", \"right\"];\r\n  let foundEdge: Edge | null = null;\r\n  let foundOffset = 0;\r\n\r\n  // 2. Attempt Modern API (CSS Typed OM)\r\n  if (\"computedStyleMap\" in element) {\r\n    try {\r\n      const map = element.computedStyleMap();\r\n      for (const edge of edges) {\r\n        const val = map.get(edge);\r\n\r\n        // In Typed OM, 'auto' is a CSSKeywordValue. We only want CSSUnitValue.\r\n        if (val && \"value\" in val && typeof val.value === \"number\") {\r\n          if (foundEdge) {\r\n            // Restore before returning\r\n            if (isManaged) element.style.position = prevPosition;\r\n            return { valid: false, edge: \"top\", offset: 0 };\r\n          }\r\n          foundEdge = edge;\r\n          foundOffset = val.value;\r\n        }\r\n      }\r\n    } catch (e) {}\r\n  }\r\n\r\n  // 3. Fallback (Firefox / Legacy) or if Typed OM was skipped\r\n  if (!foundEdge) {\r\n    const style = getComputedStyle(element);\r\n    for (const edge of edges) {\r\n      const value = style.getPropertyValue(edge);\r\n      // Check for non-auto, non-empty values\r\n      if (value && value !== \"auto\" && value !== \"\") {\r\n        if (foundEdge) {\r\n          if (isManaged) element.style.position = prevPosition;\r\n          return { valid: false, edge: \"top\", offset: 0 };\r\n        }\r\n        foundEdge = edge;\r\n        foundOffset = parseFloat(value) || 0;\r\n      }\r\n    }\r\n  }\r\n\r\n  // 4. Restore State\r\n  if (isManaged) {\r\n    element.style.position = prevPosition;\r\n  }\r\n\r\n  return foundEdge ? { valid: true, edge: foundEdge, offset: foundOffset } : { valid: false, edge: \"top\", offset: 0 };\r\n};\r\n","import { CONFIG } from \"./constants\";\r\nimport { applyStatic, applySticky, applyTransform, getScrollPosition, isCompletelyOutOfView } from \"./dom\";\r\nimport { ElementState } from \"./types\";\r\n\r\nexport const updateElementState = (state: ElementState) => {\r\n  const { element, parent, lastScrollPos, naturalRect, cachedConfig: config, cachedViewportSize: viewportSize } = state;\r\n  const { edge } = config;\r\n\r\n  if (!config.valid) {\r\n    if (state.isSticky || state.isTransforming) {\r\n      element.style.position = \"static\";\r\n      element.style.transform = \"\";\r\n      state.isSticky = false;\r\n      state.isTransforming = false;\r\n    }\r\n    return;\r\n  }\r\n\r\n  // Determine Directionality\r\n  const isStartAnchor = edge === \"top\" || edge === \"left\";\r\n  const isVertical = edge === \"top\" || edge === \"bottom\";\r\n\r\n  const currentScroll = getScrollPosition(parent, edge);\r\n  const scrollDelta = currentScroll - lastScrollPos;\r\n\r\n  const edgePadding = state.cachedViewportPadding[edge];\r\n  const offset = config.offset + edgePadding;\r\n\r\n  state.lastScrollPos = currentScroll;\r\n\r\n  // Dimensions\r\n  const naturalStart = isVertical ? naturalRect.top : naturalRect.left;\r\n  const dimension = isVertical ? naturalRect.height : naturalRect.width;\r\n\r\n  // Logic Inversion for End Anchors (Bottom/Right)\r\n  const isScrollingAway = isStartAnchor ? scrollDelta > 0 : scrollDelta < 0;\r\n  const isScrollingToward = isStartAnchor ? scrollDelta < 0 : scrollDelta > 0;\r\n\r\n  // --- Reset Check (Natural Position) ---\r\n  // If we are \"safe\" in natural flow, reset to static.\r\n  let isNaturalSafe = false;\r\n\r\n  if (isStartAnchor) {\r\n    // Top/Left: Safe if natural pos is below the sticky line\r\n    isNaturalSafe = naturalStart >= currentScroll + offset - CONFIG.epsilon;\r\n  } else {\r\n    // Bottom/Right: Safe if natural pos is above the sticky line\r\n    // Sticky Line = Scroll + Viewport - Offset\r\n    // Element End = naturalStart + dimension\r\n    isNaturalSafe = naturalStart + dimension <= currentScroll + viewportSize - offset + CONFIG.epsilon;\r\n  }\r\n\r\n  if (isNaturalSafe) {\r\n    if (state.isSticky || state.isTransforming) {\r\n      applyStatic(state);\r\n      state.isSticky = false;\r\n      state.isTransforming = false;\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  // --- Logic B: Scroll Away (Hide) ---\r\n  if (isScrollingAway) {\r\n    if (state.isSticky) {\r\n      // Transition from Sticky -> Revealed (Drifting off)\r\n      let translation = 0;\r\n\r\n      if (isStartAnchor) {\r\n        // Target Visual = Scroll + Offset\r\n        // Translate = Target - Natural\r\n        const visualPos = currentScroll + offset;\r\n        translation = visualPos - naturalStart;\r\n      } else {\r\n        // Target Visual = Scroll + Viewport - Offset - Dimension\r\n        // (We position the top-left, so we subtract dimension to align bottom-right)\r\n        const visualPos = currentScroll + viewportSize - offset - dimension;\r\n        translation = visualPos - naturalStart;\r\n      }\r\n\r\n      if (isVertical) applyTransform(state, 0, translation);\r\n      else applyTransform(state, translation, 0);\r\n\r\n      state.isSticky = false;\r\n      state.isTransforming = true;\r\n    }\r\n\r\n    // Exit Reset: If completely off screen, just go static/invisible\r\n    if (state.isTransforming && isCompletelyOutOfView(element, parent)) {\r\n      applyStatic(state);\r\n      state.isTransforming = false;\r\n    }\r\n    return;\r\n  }\r\n\r\n  // --- Logic C: Scroll Toward (Reveal) ---\r\n  if (isScrollingToward) {\r\n    // Only reveal if we have naturally passed the element (it's off-screen)\r\n    let isNaturallyPassed = false;\r\n    if (isStartAnchor) {\r\n      isNaturallyPassed = naturalStart + dimension < currentScroll;\r\n    } else {\r\n      isNaturallyPassed = naturalStart > currentScroll + viewportSize;\r\n    }\r\n\r\n    // 1. Reveal (Transition State)\r\n    if (!state.isSticky && !state.isTransforming && isNaturallyPassed) {\r\n      let translation = 0;\r\n\r\n      if (isStartAnchor) {\r\n        // Place just above/left of viewport\r\n        const targetVisualPos = currentScroll - dimension;\r\n        translation = targetVisualPos - naturalStart;\r\n      } else {\r\n        // Place just below/right of viewport\r\n        const targetVisualPos = currentScroll + viewportSize;\r\n        translation = targetVisualPos - naturalStart;\r\n      }\r\n\r\n      if (isVertical) applyTransform(state, 0, translation);\r\n      else applyTransform(state, translation, 0);\r\n\r\n      state.isTransforming = true;\r\n    }\r\n\r\n    // 2. Sticky Docking (Logic D)\r\n    if (state.isTransforming) {\r\n      const currentVisualPos = naturalStart + state.currentTranslation;\r\n      let shouldStick = false;\r\n\r\n      if (isStartAnchor) {\r\n        const stickyThreshold = currentScroll + offset;\r\n        // If we slid down enough to hit the top offset\r\n        shouldStick = currentVisualPos >= stickyThreshold - CONFIG.epsilon;\r\n      } else {\r\n        const stickyThreshold = currentScroll + viewportSize - offset;\r\n        // If we slid up enough to hit the bottom offset\r\n        shouldStick = currentVisualPos + dimension <= stickyThreshold + CONFIG.epsilon;\r\n      }\r\n\r\n      if (shouldStick) {\r\n        applySticky(element);\r\n        state.isSticky = true;\r\n        state.isTransforming = false;\r\n      }\r\n    }\r\n  }\r\n};\r\n","import { CONFIG } from \"./constants\";\r\nimport {\r\n  applyStatic,\r\n  applySticky,\r\n  defaultPaddingConfig,\r\n  getContainerPadding,\r\n  getScrollParent,\r\n  injectAnimationBeacon,\r\n  measureNaturalRect,\r\n  measureViewportSize,\r\n  readConfigFromDOM,\r\n} from \"./dom\";\r\nimport { updateElementState } from \"./state\";\r\nimport { ElementState } from \"./types\";\r\n\r\nconst stateRegistry = new Map<HTMLElement, ElementState>();\r\nconst cleanupRegistry = new Map<HTMLElement, () => void>();\r\n\r\n// Throttling map for requestAnimationFrame - to keep scheduled handlers from stacking up\r\nconst resizeTickMap = new WeakMap<ElementState, boolean>();\r\n\r\nconst refreshState = (state: ElementState) => {\r\n  const { element, parent } = state;\r\n  state.cachedConfig = readConfigFromDOM(element);\r\n  state.naturalRect = measureNaturalRect(element, parent);\r\n  state.cachedViewportSize = measureViewportSize(parent, state.cachedConfig.edge);\r\n  state.cachedViewportPadding = getContainerPadding(parent);\r\n\r\n  // Safe Reset\r\n  if (state.isSticky) {\r\n    applySticky(element);\r\n  } else {\r\n    applyStatic(state);\r\n    state.isTransforming = false;\r\n  }\r\n\r\n  updateElementState(state);\r\n};\r\n\r\nconst scheduleRefresh = (state: ElementState) => {\r\n  if (resizeTickMap.get(state)) return;\r\n\r\n  window.requestAnimationFrame(() => {\r\n    refreshState(state);\r\n    resizeTickMap.set(state, false);\r\n  });\r\n  resizeTickMap.set(state, true);\r\n};\r\n\r\n// --- Observers & Listeners ---\r\nconst handleResizeObserver = (entries: ResizeObserverEntry[]) => {\r\n  const changedNodes = new Set(entries.map((e) => e.target));\r\n\r\n  for (const state of stateRegistry.values()) {\r\n    if (changedNodes.has(state.element) || changedNodes.has(state.parent)) {\r\n      scheduleRefresh(state);\r\n    }\r\n  }\r\n};\r\n\r\nconst handleVisualViewport = () => {\r\n  for (const state of stateRegistry.values()) {\r\n    if (state.parent === document.documentElement || state.parent === document.body) {\r\n      scheduleRefresh(state);\r\n    }\r\n  }\r\n};\r\n\r\nconst resizeObserver = new ResizeObserver(handleResizeObserver);\r\n\r\n// --- Lifecycle ---\r\nexport const mountElement = (element: HTMLElement) => {\r\n  if (stateRegistry.has(element)) return;\r\n\r\n  const parent = getScrollParent(element);\r\n\r\n  const attributeObserver = new MutationObserver((mutations) => {\r\n    for (const mutation of mutations) {\r\n      if (mutation.type === \"attributes\" && mutation.attributeName === \"class\") {\r\n        if (!element.classList.contains(CONFIG.className)) {\r\n          cleanupRegistry.get(element)?.();\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n  attributeObserver.observe(element, {\r\n    attributes: true,\r\n    attributeFilter: [\"class\"],\r\n  });\r\n\r\n  const state: ElementState = {\r\n    element,\r\n    parent,\r\n    naturalRect: { top: 0, left: 0, height: 0, width: 0 } as DOMRect,\r\n    lastScrollPos: 0,\r\n    isSticky: false,\r\n    isTransforming: false,\r\n    currentTranslation: 0,\r\n    cachedConfig: { valid: false, edge: \"top\", offset: 0 },\r\n    cachedViewportSize: 0,\r\n    cachedViewportPadding: defaultPaddingConfig,\r\n    attributeObserver,\r\n  };\r\n\r\n  element.setAttribute(CONFIG.attrName, \"static\");\r\n  stateRegistry.set(element, state);\r\n\r\n  refreshState(state);\r\n\r\n  resizeObserver.observe(element);\r\n  resizeObserver.observe(parent);\r\n\r\n  let scrollTick = false;\r\n  const onScroll = () => {\r\n    if (scrollTick) return;\r\n    window.requestAnimationFrame(() => {\r\n      updateElementState(state);\r\n      scrollTick = false;\r\n    });\r\n    scrollTick = true;\r\n  };\r\n\r\n  const scrollTarget = parent === document.documentElement ? window : parent;\r\n  scrollTarget.addEventListener(\"scroll\", onScroll, { passive: true });\r\n\r\n  cleanupRegistry.set(element, () => {\r\n    scrollTarget.removeEventListener(\"scroll\", onScroll);\r\n    attributeObserver.disconnect();\r\n\r\n    resizeObserver.unobserve(element);\r\n\r\n    let parentInUse = false;\r\n    for (const [el, s] of stateRegistry.entries()) {\r\n      if (el !== element && s.parent === parent) {\r\n        parentInUse = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (!parentInUse) {\r\n      resizeObserver.unobserve(parent);\r\n    }\r\n\r\n    stateRegistry.delete(element);\r\n    cleanupRegistry.delete(element);\r\n  });\r\n};\r\n\r\nexport const handleMutations = (mutations: MutationRecord[]) => {\r\n  let checkRemovals = false;\r\n\r\n  for (const { type, addedNodes, removedNodes } of mutations) {\r\n    if (type === \"childList\") {\r\n      addedNodes.forEach((node) => {\r\n        if (node instanceof HTMLElement) {\r\n          if (node.classList.contains(CONFIG.className)) mountElement(node);\r\n          node.querySelectorAll(`.${CONFIG.className}`).forEach((el) => mountElement(el as HTMLElement));\r\n        }\r\n      });\r\n      checkRemovals = checkRemovals || Boolean(removedNodes.length);\r\n    }\r\n  }\r\n\r\n  if (checkRemovals) {\r\n    Array.from(cleanupRegistry.keys()).forEach((node) => {\r\n      if (!document.contains(node)) cleanupRegistry.get(node)?.();\r\n    });\r\n  }\r\n};\r\n\r\nconst handleAnimationStart = (event: AnimationEvent) => {\r\n  if (event.animationName === \"sticky-polite-announce\") {\r\n    const node = event.target as HTMLElement;\r\n    if (!cleanupRegistry.has(node)) {\r\n      mountElement(node);\r\n    }\r\n  }\r\n};\r\n\r\nexport const initPoliteSticky = () => {\r\n  injectAnimationBeacon();\r\n  document.addEventListener(\"animationstart\", handleAnimationStart);\r\n\r\n  if (window.visualViewport) {\r\n    window.visualViewport.addEventListener(\"resize\", handleVisualViewport);\r\n  } else {\r\n    window.addEventListener(\"resize\", handleVisualViewport);\r\n  }\r\n\r\n  document.querySelectorAll(`.${CONFIG.className}`).forEach((el) => mountElement(el as HTMLElement));\r\n\r\n  new MutationObserver(handleMutations).observe(document.body, {\r\n    childList: true,\r\n    subtree: true,\r\n  });\r\n};\r\n","/**\r\n * Polite Sticky (Directional Reveal) Utility\r\n */\r\n\r\nimport { initPoliteSticky } from \"./observer\";\r\n\r\nif (typeof window !== \"undefined\") {\r\n  if (document.readyState === \"loading\") {\r\n    document.addEventListener(\"DOMContentLoaded\", initPoliteSticky);\r\n  } else {\r\n    initPoliteSticky();\r\n  }\r\n}\r\n\r\nexport default initPoliteSticky;\r\n"]}